<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Circles' head scripts [REQUIRED] -->
    <circles-start-scripts/>
</head>
  <body>
    <!-- this is used to create our enter UI that creates a 2D overlay to capture a user gesture for sound/mic access etc. -->
    <circles-start-ui/>

    <!-- a-scene with 'circles-properties' component [REQUIRED] -->
    <a-scene circles_scene_properties>

      <!-- assets -->
      <a-assets>
        <img id='skyMap' src='/global/assets/textures/equirectangular/WhiteBlue.jpg' crossorigin="anonymous">
        
        <!-- Circles' built-in assets [REQUIRED] -->
        <circles-assets/>
      </a-assets>

      <!-- Circles' built-in manager and avatar [REQUIRED] -->
      <circles-manager-avatar/>
        
        <a-entity circles-checkpoint circles-spawnpoint position="0.0 0.0 0.0"></a-entity>
        
        <a-entity   geometry="primitive:plane; width:1.6; height:2.0" position="0.0 1.5 -2.5" 
                    circles-platform-mirror="textureSizeDesktop:1024; textureSizeMobile:512; textureSizeHMD:1024; color:#000;"></a-entity>

      <!-- Body Shape Choices -->
      <a-entity id="body_choices" position="-1.3 3.0 -2">
        <a-entity position="-0.7 -1.0 0" circles-label="text:Torso; arrow_position:right; lookAtCamera:false;"></a-entity>
        <a-entity rotation="0 180 0">
            <a-entity class="body_costume" position="0 -0.0 0" scale="0.7 0.7 0.7" circles-costume="body_type:body; color:; model:0; label_visible:false; persist:true;"></a-entity>
            <a-entity class="body_costume" position="0 -0.5 0" scale="0.7 0.7 0.7" circles-costume="body_type:body; color:; model:1; label_visible:false; persist:true;"></a-entity>
            <a-entity class="body_costume" position="0 -1.0 0" scale="0.7 0.7 0.7" circles-costume="body_type:body; color:; model:2; label_visible:false; persist:true;"></a-entity>
            <a-entity class="body_costume" position="0 -1.5 0" scale="0.7 0.7 0.7" circles-costume="body_type:body; color:; model:3; label_visible:false; persist:true;"></a-entity>
            <a-entity class="body_costume" position="0 -2.0 0" scale="0.7 0.7 0.7" circles-costume="body_type:body; color:; model:4; label_visible:false; persist:true;"></a-entity>
        </a-entity>
        <a-entity class="color_selector" circles-costume-color-selector="class_selector:.body_costume;" position="0.4 -0.3 0" rotation="0 0 -90"></a-entity>
      </a-entity>

      <!-- Head Shape Choices -->
    <a-entity id="head_choices" position="1.3 3.0 -2">
        <a-entity position="0.7 -1.0 0" circles-label="text:Head; arrow_position:left; lookAtCamera:false;"></a-entity>
        <a-entity rotation="0 180 0">
            <a-entity class="head_costume" position="0 -0.0 0" circles-costume="body_type:head; color:; model:0; label_visible:false; persist:true;"></a-entity>
            <a-entity class="head_costume" position="0 -0.5 0" circles-costume="body_type:head; color:; model:1; label_visible:false; persist:true;"></a-entity>
            <a-entity class="head_costume" position="0 -1.0 0" circles-costume="body_type:head; color:; model:2; label_visible:false; persist:true;"></a-entity>
            <a-entity class="head_costume" position="0 -1.5 0" circles-costume="body_type:head; color:; model:3; label_visible:false; persist:true;"></a-entity>
            <a-entity class="head_costume" position="0 -2.0 0" circles-costume="body_type:head; color:; model:4; label_visible:false; persist:true;"></a-entity>
        </a-entity>
        <a-entity class="color_selector" circles-costume-color-selector="class_selector:.head_costume;" position="-0.4 -0.3 0" rotation="0 0 -90"></a-entity>
    </a-entity>

      <!-- Body Shape Choices -->
      <a-entity id="hair_choices" position="-1.18 -0.06 -2">
        <a-entity position="1.18 -0.5 0" circles-label="text:Hair; arrow_position:up; lookAtCamera:false;"></a-entity>
        <a-entity rotation="0 180 0" position="2.36 0 0">
            <a-entity class="hair_costume" position="0.0 0 0" circles-costume="body_type:hair; color:; model:0; label_visible:false; persist:true;"></a-entity>
            <a-entity class="hair_costume" position="0.5 0 0" circles-costume="body_type:hair; color:; model:1; label_visible:false; persist:true;"></a-entity>
            <a-entity class="hair_costume" position="1.0 0 0" circles-costume="body_type:hair; color:; model:2; label_visible:false; persist:true;"></a-entity>
            <a-entity class="hair_costume" position="1.5 0 0" circles-costume="body_type:hair; color:; model:3; label_visible:false; persist:true;"></a-entity>
            <a-entity class="hair_costume" position="2.0 0 0" circles-costume="body_type:hair; color:; model:4; label_visible:false; persist:true;"></a-entity>
            <a-entity class="hair_costume" position="2.5 0 0" circles-costume="body_type:hair; color:; model:5; label_visible:false; persist:true;"></a-entity>
        </a-entity>
        <a-entity class="color_selector" circles-costume-color-selector="class_selector:.hair_costume;" position="0.2 0.5 0" rotation="0 0 0"></a-entity>
      </a-entity>

      <!-- by default this portal will point to the "fire"; but we will change to last_visited if there is a world marked as last visisted in url search params (see script at bottm) -->>
      <a-entity id="portal"
                position="0.0 1.7 5.0" rotation="0 90 0" scale="1 1 1"
                circles-portal="img_src:/global/assets/textures/equirectangular/WhiteBlue.jpg; title_text:The Fire; link_url:/w/Campfire"></a-entity>

      <a-entity light="type:ambient; color:#FFF; intensity:3.0"></a-entity>

      <a-entity id='skyBox' 
                geometry='primitive:sphere; radius:50; segments-height:6; segments-width:6;'
                material='shader:flat; src:#skyMap; side:back;'>
      </a-entity>

    </a-scene>

        <!-- Circles' end scripts [REQUIRED] -->
        <circles-end-scripts/>

        <script>
          //want to add new user parametsr to url so they propagate

          //want to modify portal with 'last_visited' parameter
          const urlParams = new URLSearchParams(window.location.search);
          if (urlParams.has('last_route')) {
            const portalElem = document.querySelector('#portal');
            const urlArr = urlParams.get('last_route').split('/');  //get last bit of this array for the world name
            portalElem.setAttribute('circles-portal', {title_text:urlArr[urlArr.length-1], link_url:urlParams.get('last_route')})
          }
        </script>
    </body>
</html>